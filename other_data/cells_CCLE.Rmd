---
title: "Step1_CCLE_look"
author: "Ieva"
date: "2023-08-23"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(DESeq2)
library(glmnet)
```
Parsisiunčiau CCLE projekto data per linux, gzip, išparsinau į assay data. PArsisiunčiau RNA-SEQ counts
```{r}
CCLE_counts <- readRDS("C:/Users/Ieva/Desktop/NVI GDL/R projetcs/tcga-ov-data/GTEX/CLLE_COUNTS.RDS")
ccle_anno <- read.delim("C:/Users/Ieva/Desktop/NVI GDL/R projetcs/tcga-ov-data/GTEX/Cell_lines_annotations_20181226.txt")
```
#take only OVARIAN lines
```{r}
CCLE_ovarian <- CCLE_counts[, grepl("_OVARY$", colnames(CCLE_counts))]
colnames(CCLE_ovarian)
```
as you can see there are 47 lines in total
Bet kol kas nežinau jų tipų, todėl parsisiunčiau iš cbioportal broad institute ccle 2019 m.  klinikinius, nes prie ccle 2012 nebuvo, plius pas mane yra '19 metu duomenys
OC non-cancer linijos būtų IHOSE, kaip suprantu iš straipsniu išeina kad "IOSE" yra tos "normal" pvz. IOSE364, kadangi jų neatrinko mano grepl tai teks iš kitos pusės bandyt

```{r}
broad <- read.delim("C:/Users/Ieva/Desktop/NVI GDL/R projetcs/tcga-ov-data/GTEX/ccle_broad_2019_clinical_data.tsv")
types <- broad[, c(2, 7)] #palieku tik 2 svarbiausius
dim(types)
table(types$Cancer.Type.Detailed)
#idomu kad tie Epilelial tumor yra
filter(types, types$Cancer.Type.Detailed == "Ovarian Epithelial Tumor")
```
Peržiūrėjusi klinikinius truputį pakeičiu filtravimo strategiją, 
filtruodama pagal tip1 prarandu tik vieną fibroblastų liniją, bet netyčia gaunu vieną sarkomą
```{r}
ccle_anno_ovar <- filter(ccle_anno, ccle_anno$type_refined == "ovary" )
head(ccle_anno_ovar)
ccle_anno_ovar <- filter(ccle_anno_ovar, ccle_anno_ovar$CCLE_ID != "RKN_SOFT_TISSUE" )
#cool 63 linijos, dabar nusifiltruojam countus
ovarian_cell_names <- ccle_anno_ovar$CCLE_ID #panašu kad counts ner tiek daug kiek klinikinių
ovarian_counts <- CCLE_counts[,(colnames(CCLE_counts) %in% ovarian_cell_names)]
OV_47_line_names <- colnames(ovarian_counts) #lieka tie patys 47!!
#tai reik nusifiltruot ir klinikinius
ccle_anno_ovar <- ccle_anno_ovar[(ccle_anno_ovar$CCLE_ID %in% OV_47_line_names), ]
broad_47_lines <- broad[(broad$Sample.ID %in% OV_47_line_names), ]
dim(ccle_anno_ovar) #klinikiniai final
dim(ovarian_counts) #countai final
dim(broad_47_lines) #broad klinikiniai duomenys aprašo tik 43 iš 47 linijų
setdiff(ccle_anno_ovar$CCLE_ID, broad_47_lines$Patient.ID) #kurios nėra aprašytos broad
```
"COV434_OVARY" - sexcord  ; "KURAMOCHI_OVARY" - HGSOC ; "TYKNU_OVARY"  - same as kuramochi   "OELE_OVARY" - HGSOC

nei vienos iš normal nėr :()
įsitikinam kokias grupes turim
```{r}
table(broad_47_lines$Cancer.Type.Detailed) 
```
Apsijungiam klinikinius?
```{r}
broad_47_lines$CCLE_ID <- broad_47_lines$Patient.ID
CCLE_clinincal <- left_join( ccle_anno_ovar,broad_47_lines, by = "CCLE_ID")
dim(CCLE_clinincal)
table(CCLE_clinincal$Cancer.Type.Detailed, useNA = "a")
#fill the missing "Cancer.Type.Detailed"
CCLE_clinincal[17, 40] <- "Granulosa cell tumour"
CCLE_clinincal[c(25, 39, 46), 40] <- "High-Grade Serous Ovarian Cancer"
table(CCLE_clinincal$Cancer.Type.Detailed, useNA = "a")
```
Kai susitvarkiau grupes mano klausimas kuirų genų raiška skiriasi tarp HGSOC ir visų kitų
```{r}
CCLE_clinincal$hgsoc_vs_others <- as.factor(CCLE_clinincal$Cancer.Type.Detailed )
CCLE_clinincal$hgsoc_vs_others <- fct_collapse(CCLE_clinincal$hgsoc_vs_others, other = c("Brenner Tumor", "Endometrioid Ovarian Cancer", "Mixed Ovarian Carcinoma", "Ovarian Epithelial Tumor", "Clear Cell Ovarian Cancer", "Granulosa cell tumour", "Low-Grade Serous Ovarian Cancer", "Mucinous Ovarian Cancer", "Serous Ovarian Cancer"), hgsoc = "High-Grade Serous Ovarian Cancer")
table(CCLE_clinincal$hgsoc_vs_others)
```
# kol kas iškritų nieškosiu, iš karto DESEQ, be vst ir filtrinimo 75 proc
```{r}
# create dds
dds <- DESeqDataSetFromMatrix(countData = ovarian_counts,
                              colData = CCLE_clinincal,
                              design = ~ 1) # not spcifying model

# get normalized counts
norm.counts <- assay(dds) %>% 
  t()

```
```{r}
y_factor <- CCLE_clinincal$hgsoc_vs_others
res_ccle = cv.glmnet(
  x = norm.counts,
  y = y_factor,
  alpha = 0.5, 
  family = "binomial"
)
res_ccle # 0 selected

```





